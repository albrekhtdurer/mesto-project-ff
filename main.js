(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,n,r,o,a){if("object"===e(t)&&t.name&&t.link){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);u.id=t._id;var i=u.querySelector(".card__title"),c=u.querySelector(".card__image");i.textContent=t.name,c.src=t.link,c.alt=t.name,c.addEventListener("click",o);var s=u.querySelector(".card__delete-button");a===t.owner._id?s.addEventListener("click",n):s.remove();var l=u.querySelector(".card__like-button");return l.addEventListener("click",r),t.likes&&t.likes.length>0&&(u.querySelector(".card__likes").textContent=t.likes.length,t.likes.some((function(t){return t._id===a}))&&l.classList.add("card__like-button_is-active")),u}}function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(t){"Escape"===t.key&&o(document.querySelector(".popup_is-opened"))}function u(t){var e=t.formElement,n=t.inputElement,r=t.inputErrorClass,o=t.errorClass,a=e.querySelector(".".concat(n.id,"-input-error"));n.classList.remove(r),a.classList.remove(o),a.textContent=""}function i(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))}function c(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));n.forEach((function(r){u({formElement:t,inputElement:r,inputErrorClass:e.inputErrorClass,errorClass:e.errorClass});var o=e.inputTextsToClear,a=t.querySelector(e.submitButtonSelector);o&&o.length>0&&o.includes(r.id)&&(r.value=""),i(n,a,e.inactiveButtonClass)}))}t.p="";var s={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-41",headers:{authorization:"fac52df7-7355-4929-9fc5-993340251a1d","Content-Type":"application/json"}};function l(t){return s.baseUrl+t}var p=function(t){var e=l("/cards/likes/".concat(t));return fetch(e,{method:"PUT",headers:s.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при добавлении лайка: ".concat(t.status))}))},d=function(t){var e=l("/cards/likes/".concat(t));return fetch(e,{method:"DELETE",headers:s.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при удалении лайка: ".concat(t.status))}))};function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p;var m=document.querySelector(".popup_type_image"),_=m.querySelector(".popup__image"),v=m.querySelector(".popup__caption"),y=document.querySelector(".places__list"),h=document.forms["edit-profile"],b=h.elements.name,S=h.elements.description,C={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"},E=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),q=document.querySelector(".popup_type_edit"),L=document.querySelector(".profile__edit-button"),x=h.querySelector(".popup__button"),j=document.forms["new-place"],T=j.elements["place-name"],A=j.elements.link,B={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inputTextsToClear:["place","link"],submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"},P=document.querySelector(".popup_type_new-card"),w=document.querySelector(".profile__add-button"),D=j.querySelector(".popup__button"),O=document.forms["edit-avatar"],M=O.elements["avatar-url"],I={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inputTextsToClear:["avatar-url"],submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"},N=document.querySelector(".popup_type_edit_avatar"),U=O.querySelector(".popup__button"),H=document.querySelector(".popup_type_error");H.querySelector(".popup__button").addEventListener("click",(function(){o(H)}));var J,G,V=H.querySelector(".popup__text"),z=document.querySelector(".popup_type_confirm_delete"),W=z.querySelector(".popup__button"),$=[P,q,m,N,H,z],F="";function K(t,e){t.textContent=e}function Q(t){V.textContent=t,r(H)}function R(t){_.src=t.target.src,_.alt=t.target.alt,v.textContent=t.target.alt}function X(t,e,n){"start"===e?n.prepend(t):"end"===e&&n.append(t)}function Y(t){var e=t.currentTarget.closest(".card"),n=e.id;r(z),W.addEventListener("click",(function(t){var r,a,u=W.textContent;K(W,"Удаление..."),t.preventDefault(),(r=n,a=l("/cards/".concat(r)),fetch(a,{method:"DELETE",headers:s.headers}).then((function(t){return!!t.ok||Promise.reject("Ошибка при удалении карточки: ".concat(t.status))}))).then((function(){!function(t){t.remove()}(e),o(z)})).catch((function(t){Q(t)})).finally((function(){K(W,u)}))}))}function Z(t){var e=t.currentTarget.closest(".card"),n=e.id;(t.currentTarget.classList.contains("card__like-button_is-active")?d:p)(n).then((function(n){var r=e.querySelector(".card__likes");n.likes.length>0?r.textContent=n.likes.length:0===n.likes.length&&r.remove(),function(t){t.target.classList.toggle("card__like-button_is-active")}(t)})).catch((function(t){Q(t)}))}y.addEventListener("click",(function(t){t.target.classList.contains("card__image")&&r(m)})),Promise.all([(J=l("/users/me"),fetch(J,{method:"GET",headers:s.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при получении данных пользователя: ".concat(t.status,". Перезагрузите страницу"))}))),function(){var t=l("/cards");return fetch(t,{method:"GET",headers:s.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при получении карточек: ".concat(t.status,". Перезагрузите страницу"))}))}()]).then((function(t){var e,r,o=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,u,i=[],c=!0,s=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(i.push(r.value),i.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(s)throw o}}return i}}(e,r)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],u=o[1];a.name&&(E.textContent=a.name),a.about&&(k.textContent=a.about),a.avatar&&(g.style.backgroundImage="url(".concat(a.avatar,")")),F=a._id,u.forEach((function(t){X(n(t,Y,Z,R,F),"end",y)}))})).catch((function(t){Q(t)})),h.addEventListener("submit",(function(t){t.preventDefault();var e=x.textContent;K(x,"Сохранение..."),function(t,e){var n=l("/users/me");return fetch(n,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при редактировании профиля: ".concat(t.status))}))}(b.value,S.value).then((function(t){E.textContent=t.name,k.textContent=t.about})).catch((function(t){Q(t)})).finally((function(){K(x,e)})),o(q)})),L.addEventListener("click",(function(){var t=E.textContent,e=k.textContent;b.value=t,S.value=e,c(h,C),r(q)})),w.addEventListener("click",(function(){c(j,B),r(P)})),j.addEventListener("submit",(function(t){t.preventDefault();var e=D.textContent;K(D,"Сохранение..."),function(t,e){var n=l("/cards");return fetch(n,{method:"POST",headers:s.headers,body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при добавлении карточки: ".concat(t.status))}))}(T.value,A.value).then((function(t){X(n(t,Y,Z,R,F),"start",y),j.reset(),o(P)})).catch((function(t){Q(t)})).finally((function(){K(D,e)}))})),O.addEventListener("submit",(function(t){t.preventDefault();var e,n=U.textContent;K(U,"Сохранение..."),(e=M.value,fetch(e,{method:"HEAD"}).then((function(t){return t.ok?t.headers.get("content-type"):Promise.reject("Ошибка при обновлении аватара: ".concat(t.status))}))).then((function(t){t.startsWith("image/")&&function(t){var e=l("/users/me/avatar");return fetch(e,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при обновлении аватара: ".concat(t.status))}))}(M.value).then((function(t){g.style.backgroundImage="url(".concat(t.avatar,")"),O.reset(),o(N)})).catch((function(t){Q(t)}))})).catch((function(t){Q(t)})).finally((function(){K(U,n)}))})),g.addEventListener("click",(function(){c(O,I),r(N)})),$.forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup_is-opened")||e.target.classList.contains("popup__close"))&&o(t)}))})),G={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(G.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()}));var e=Array.from(t.querySelectorAll(G.inputSelector)),n=t.querySelector(G.submitButtonSelector);i(e,n,G.inactiveButtonClass),function(t){var e=t.inputList,n=t.formElement,r=t.inputErrorClass,o=t.errorClass,a=t.buttonElement,c=t.inactiveButtonClass;e.forEach((function(t){t.addEventListener("input",(function(){!function(t,e,n,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u({formElement:t,inputElement:e,inputErrorClass:n,errorClass:r}):function(t){var e=t.inputElement,n=t.inputErrorClass,r=t.errorClass,o=t.errorMessage,a=t.formElement.querySelector(".".concat(e.id,"-input-error"));e.classList.add(n),a.textContent=o,a.classList.add(r)}({formElement:t,inputElement:e,inputErrorClass:n,errorClass:r,errorMessage:e.validationMessage})}(n,t,r,o),i(e,a,c)}))}))}({inputList:e,formElement:t,inputErrorClass:G.inputErrorClass,errorClass:G.errorClass,buttonElement:n,inactiveButtonClass:G.inactiveButtonClass})}))})();
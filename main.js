(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,n,r,o,a){if("object"===e(t)&&t.name&&t.link){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);u.id=t._id;var i=u.querySelector(".card__title"),c=u.querySelector(".card__image");i.textContent=t.name,c.src=t.link,c.alt=t.name,c.addEventListener("click",o);var s=u.querySelector(".card__delete-button");a===t.owner._id?s.addEventListener("click",(function(){n(u,u.id)})):s.remove();var l=u.querySelector(".card__like-button");return l.addEventListener("click",r),t.likes&&t.likes.length>0&&(u.querySelector(".card__likes").textContent=t.likes.length,t.likes.some((function(t){return t._id===a}))&&l.classList.add("card__like-button_is-active")),u}}function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(t){"Escape"===t.key&&o(document.querySelector(".popup_is-opened"))}function u(t){var e=t.formElement,n=t.inputElement,r=t.inputErrorClass,o=t.errorClass,a=e.querySelector(".".concat(n.id,"-input-error"));n.classList.remove(r),a.classList.remove(o),a.textContent=""}function i(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))}function c(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));n.forEach((function(r){u({formElement:t,inputElement:r,inputErrorClass:e.inputErrorClass,errorClass:e.errorClass});var o=e.inputTextsToClear,a=t.querySelector(e.submitButtonSelector);o&&o.length>0&&o.includes(r.id)&&(r.value=""),i(n,a,e.inactiveButtonClass)}))}function s(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}t.p="";var l={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-41",headers:{authorization:"fac52df7-7355-4929-9fc5-993340251a1d","Content-Type":"application/json"}};function p(t){return l.baseUrl+t}var d=function(t){var e=p("/cards/likes/".concat(t));return fetch(e,{method:"PUT",headers:l.headers}).then(s)},f=function(t){var e=p("/cards/likes/".concat(t));return fetch(e,{method:"DELETE",headers:l.headers}).then(s)};function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p;var _=document.querySelector(".popup_type_image"),v=_.querySelector(".popup__image"),y=_.querySelector(".popup__caption"),h=document.querySelector(".places__list"),b=document.forms["edit-profile"],S=b.elements.name,C=b.elements.description,E={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"},g=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),L=document.querySelector(".popup_type_edit"),x=document.querySelector(".profile__edit-button"),T=b.querySelector(".popup__button"),A=document.forms["new-place"],B=A.elements["place-name"],j=A.elements.link,w={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inputTextsToClear:["place","link"],submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"},D=document.querySelector(".popup_type_new-card"),P=document.querySelector(".profile__add-button"),O=A.querySelector(".popup__button"),M=document.forms["edit-avatar"],I=M.elements["avatar-url"],N={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inputTextsToClear:["avatar-url"],submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled"},U=document.querySelector(".popup_type_edit_avatar"),H=M.querySelector(".popup__button"),J=document.querySelector(".popup_type_error");J.querySelector(".popup__button").addEventListener("click",(function(){o(J)}));var G,V,z,W,$,F=J.querySelector(".popup__text"),K=document.querySelector(".popup_type_confirm_delete"),Q=K.querySelector(".popup__button"),R=Q.textContent,X=[D,L,_,U,J,K];function Y(t,e){t.textContent=e}function Z(t){F.textContent=t,r(J)}function tt(t){!function(t){v.src=t.target.src,v.alt=t.target.alt,y.textContent=t.target.alt}(t),r(_)}function et(t,e,n){"start"===e?n.prepend(t):"end"===e&&n.append(t)}function nt(t){var e,n;Y(Q,"Удаление..."),t.preventDefault(),(e=z,n=p("/cards/".concat(e)),fetch(n,{method:"DELETE",headers:l.headers}).then((function(t){return!!t.ok||Promise.reject("Ошибка ".concat(t.status))}))).then((function(){!function(t){t.remove()}(V),o(K)})).catch((function(t){Z(t)})).finally((function(){Y(Q,R)}))}function rt(t,e){V=t,z=e,console.log(z),r(K),Q.addEventListener("click",nt)}function ot(t){var e=t.currentTarget.closest(".card"),n=e.id;(t.currentTarget.classList.contains("card__like-button_is-active")?f:d)(n).then((function(n){var r=e.querySelector(".card__likes");n.likes.length>0?r.textContent=n.likes.length:0===n.likes.length&&r.remove(),function(t){t.target.classList.toggle("card__like-button_is-active")}(t)})).catch((function(t){Z(t)}))}Promise.all([(W=p("/users/me"),fetch(W,{method:"GET",headers:l.headers}).then(s)),function(){var t=p("/cards");return fetch(t,{method:"GET",headers:l.headers}).then(s)}()]).then((function(t){var e,r,o=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,u,i=[],c=!0,s=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(i.push(r.value),i.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(s)throw o}}return i}}(e,r)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],u=o[1];a.name&&(g.textContent=a.name),a.about&&(k.textContent=a.about),a.avatar&&(q.style.backgroundImage="url(".concat(a.avatar,")")),G=a._id,u.forEach((function(t){et(n(t,rt,ot,tt,G),"end",h)}))})).catch((function(t){Z(t)})),b.addEventListener("submit",(function(t){t.preventDefault();var e=T.textContent;Y(T,"Сохранение..."),function(t,e){var n=p("/users/me");return fetch(n,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:e})}).then(s)}(S.value,C.value).then((function(t){g.textContent=t.name,k.textContent=t.about,o(L)})).catch((function(t){Z(t)})).finally((function(){Y(T,e)}))})),x.addEventListener("click",(function(){var t=g.textContent,e=k.textContent;S.value=t,C.value=e,c(b,E),r(L)})),P.addEventListener("click",(function(){c(A,w),r(D)})),A.addEventListener("submit",(function(t){t.preventDefault();var e=O.textContent;Y(O,"Сохранение..."),function(t,e){var n=p("/cards");return fetch(n,{method:"POST",headers:l.headers,body:JSON.stringify({name:t,link:e})}).then(s)}(B.value,j.value).then((function(t){et(n(t,rt,ot,tt,G),"start",h),A.reset(),o(D)})).catch((function(t){Z(t)})).finally((function(){Y(O,e)}))})),M.addEventListener("submit",(function(t){t.preventDefault();var e,n=H.textContent;Y(H,"Сохранение..."),(e=I.value,fetch(e,{method:"HEAD"}).then((function(t){return t.ok?t.headers.get("content-type"):Promise.reject("Ошибка ".concat(t.status))}))).then((function(t){t.startsWith("image/")&&function(t){var e=p("/users/me/avatar");return fetch(e,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(s)}(I.value).then((function(t){q.style.backgroundImage="url(".concat(t.avatar,")"),M.reset(),o(U)})).catch((function(t){Z(t)}))})).catch((function(t){Z(t)})).finally((function(){Y(H,n)}))})),q.addEventListener("click",(function(){c(M,N),r(U)})),X.forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup_is-opened")||e.target.classList.contains("popup__close"))&&o(t),e.target.classList.contains("popup_type_confirm_delete")&&Q.removeEventListener("click",nt)}))})),$={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll($.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()}));var e=Array.from(t.querySelectorAll($.inputSelector)),n=t.querySelector($.submitButtonSelector);i(e,n,$.inactiveButtonClass),function(t){var e=t.inputList,n=t.formElement,r=t.inputErrorClass,o=t.errorClass,a=t.buttonElement,c=t.inactiveButtonClass;e.forEach((function(t){t.addEventListener("input",(function(){!function(t,e,n,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?u({formElement:t,inputElement:e,inputErrorClass:n,errorClass:r}):function(t){var e=t.inputElement,n=t.inputErrorClass,r=t.errorClass,o=t.errorMessage,a=t.formElement.querySelector(".".concat(e.id,"-input-error"));e.classList.add(n),a.textContent=o,a.classList.add(r)}({formElement:t,inputElement:e,inputErrorClass:n,errorClass:r,errorMessage:e.validationMessage})}(n,t,r,o),i(e,a,c)}))}))}({inputList:e,formElement:t,inputErrorClass:$.inputErrorClass,errorClass:$.errorClass,buttonElement:n,inactiveButtonClass:$.inactiveButtonClass})}))})();